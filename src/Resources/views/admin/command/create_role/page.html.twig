{% extends '@' ~ app_vendor ~ '_roles/layout.html.twig' %}


{% set html_title = 'Create Role' %}
{% set page_title = html_title %}


{% block content %}
  <div class="panel">
    <div class="panel-body xpb-5">
      {{ form_errors(pbj_form) }}
      {{ form_start(pbj_form, {'attr': {'id': pbj_form.vars.id}}) }}

      <fieldset>
        <legend><strong>Role Info</strong></legend>
        <div class="row">
          <div class="col-md-6">
            {{ form_row(pbj_form.node._id) }}
          </div>
        </div>
      </fieldset>
      <fieldset>
        <legend><strong>Allowed Permissions</strong></legend>
        <div class="row">
          <div class="col-md-6">

            <ul id="allowed-set"
                data-prototype="{{ form_widget(pbj_form.node.allowed.vars.prototype)|e('html_attr') }}">
              {% for allowed in pbj_form.node.allowed %}
                <li>
                  {{ form_errors(allowed) }}
                  {{ form_widget(allowed) }}
                </li>
              {% endfor %}
            </ul>

            <a href="#" id="add-field">Add</a>
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend><strong>Denied Permissions</strong></legend>
        <div class="row">
          <div class="col-md-6">
            {{ form_row(pbj_form.node.denied) }}
            <a class="btn btn-sm btn-primary">add</a>
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend><strong>&nbsp;</strong></legend>
        <button type="submit" class="btn btn-primary btn-xlg">Create Role</button>
        <a href="{{ path('gdbots_iam_admin_list_role') }}" class="btn btn-link">Cancel</a>
      </fieldset>

      <div style="display: none;">
        {{ form_rest(pbj_form) }}
      </div>
      {{ form_end(pbj_form) }}<!--/#{{ pbj_form.vars.id }}-->
    </div>
  </div>

  <script>
    var allowedCount = '{{ pbj_form.node.allowed|length }}';

    jQuery(document).ready(function() {
      jQuery('#add-field').click(function(e) {
        e.preventDefault();

        var allowedSet = jQuery('#allowed-set');
        var newWidget = allowedConllecion.attr('data-prototype');

        newWidget = newWidget.replace(/__name__/g, allowedCount);
        allowedCount++;

        // create a new list element and add it to the list
        var newLi = jQuery('<li></li>').html(newWidget);
        newLi.appendTo(allowedSet);
      });
    })
  </script>
{% endblock %}
